#:import dp kivy.metrics.dp

# ---------- UI defaults (polish) ----------
<MDCard>:
    radius: [dp(16), dp(16), dp(16), dp(16)]
    elevation: 1

<MDRaisedButton>:
    size_hint_y: None
    height: dp(44)

<AppCard@MDCard>:
    padding: dp(14)
    radius: [dp(18), dp(18), dp(18), dp(18)]
    elevation: 1

<SectionTitle@MDLabel>:
    font_style: "Subtitle1"
    bold: True
    size_hint_y: None
    height: self.texture_size[1] + dp(8)

<HintText@MDLabel>:
    theme_text_color: "Hint"
    font_style: "Caption"
    size_hint_y: None
    height: self.texture_size[1] + dp(6)

<ActionRow@MDBoxLayout>:
    size_hint_y: None
    height: dp(44)
    spacing: dp(10)

<MoreItem>:
    icon: "chevron-right"
    IconLeftWidget:
        icon: root.icon

RootSM:
    HomeScreen:
        name: "home"
    BossesScreen:
        name: "bosses"
    BoostedScreen:
        name: "boosted"
    TrainingScreen:
        name: "training"
    ImbuementsScreen:
        name: "imbuements"
    HuntScreen:
        name: "hunt"
    StaminaScreen:
        name: "stamina"
    SettingsScreen:
        name: "settings"
    BossFavoritesScreen:
        name: "boss_favorites"


<HomeScreen@MDScreen>:
    char_last_url: ""

    MDBoxLayout:
        orientation: "vertical"

        MDTopAppBar:
            title: "Tibia Tools"
            elevation: 2

        MDBottomNavigation:
            id: bottom_nav
            panel_color: app.theme_cls.bg_normal


            MDBottomNavigationItem:
                name: "tab_dashboard"
                text: "Home"
                icon: "home"

                MDScrollView:
                    do_scroll_x: False

                    MDBoxLayout:
                        orientation: "vertical"
                        padding: dp(12)
                        spacing: dp(12)
                        size_hint_y: None
                        height: self.minimum_height

                        MDCard:
                            padding: dp(12)
                            radius: [dp(16), dp(16), dp(16), dp(16)]
                            elevation: 1
                            size_hint_y: None
                            height: self.minimum_height

                            MDBoxLayout:
                                orientation: "vertical"
                                spacing: dp(6)
                                size_hint_y: None
                                height: self.minimum_height

                                MDBoxLayout:
                                    size_hint_y: None
                                    height: dp(36)

                                    MDLabel:
                                        text: "Boosted hoje"
                                        bold: True

                                    MDIconButton:
                                        icon: "refresh"
                                        on_release: app.dashboard_refresh()

                                ClickableRow:
                                    orientation: "horizontal"
                                    spacing: dp(10)
                                    size_hint_y: None
                                    height: dp(56)
                                    on_release: app.open_boosted_from_home("creature")
                                    AnchorLayout:
                                        size_hint: None, None
                                        size: dp(56), dp(56)
                                        anchor_x: "center"
                                        anchor_y: "center"
                                        AsyncImage:
                                            id: dash_boost_creature_sprite
                                            source: ""
                                            size_hint: None, None
                                            size: dp(48), dp(48)
                                            allow_stretch: True
                                            keep_ratio: True
                                            opacity: 1 if self.source else 0
                                    MDLabel:
                                        id: dash_boost_creature
                                        text: "-"
                                        valign: "middle"
                                        halign: "left"
                                        text_size: self.size

                                ClickableRow:
                                    orientation: "horizontal"
                                    spacing: dp(10)
                                    size_hint_y: None
                                    height: dp(56)
                                    on_release: app.open_boosted_from_home("boss")
                                    AnchorLayout:
                                        size_hint: None, None
                                        size: dp(56), dp(56)
                                        anchor_x: "center"
                                        anchor_y: "center"
                                        AsyncImage:
                                            id: dash_boost_boss_sprite
                                            source: ""
                                            size_hint: None, None
                                            size: dp(48), dp(48)
                                            allow_stretch: True
                                            keep_ratio: True
                                            opacity: 1 if self.source else 0
                                    MDLabel:
                                        id: dash_boost_boss
                                        text: "-"
                                        valign: "middle"
                                        halign: "left"
                                        text_size: self.size

                                MDLabel:
                                    id: dash_boost_updated
                                    text: ""
                                    theme_text_color: "Hint"
                                    size_hint_y: None
                                    height: self.texture_size[1] + dp(6)

                        MDCard:
                            padding: dp(12)
                            radius: [dp(16), dp(16), dp(16), dp(16)]
                            elevation: 1
                            size_hint_y: None
                            height: self.minimum_height

                            MDBoxLayout:
                                orientation: "vertical"
                                spacing: dp(6)
                                size_hint_y: None
                                height: self.minimum_height

                                MDBoxLayout:
                                    size_hint_y: None
                                    height: dp(36)

                                    MDLabel:
                                        text: "Último char"
                                        bold: True

                                    MDIconButton:
                                        icon: "account-search"
                                        on_release: app.select_home_tab("tab_char")

                                MDLabel:
                                    id: dash_last_char
                                    text: "-"
                                    size_hint_y: None
                                    height: self.texture_size[1] + dp(6)

                                MDRaisedButton:
                                    text: "Abrir último no Tibia.com"
                                    on_release: app.dashboard_open_last_char()

                        MDCard:
                            padding: dp(12)
                            radius: [dp(16), dp(16), dp(16), dp(16)]
                            elevation: 1
                            size_hint_y: None
                            height: self.minimum_height

                            MDBoxLayout:
                                orientation: "vertical"
                                spacing: dp(6)
                                size_hint_y: None
                                height: self.minimum_height

                                MDBoxLayout:
                                    size_hint_y: None
                                    height: dp(36)

                                    MDLabel:
                                        text: "Bosses favoritos (High)"
                                        bold: True

                                    MDIconButton:
                                        icon: "skull"
                                        on_release: app.open_more_target("bosses")

                                MDLabel:
                                    id: dash_boss_hint
                                    text: "Configure favoritos na tela Bosses."
                                    theme_text_color: "Hint"
                                    size_hint_y: None
                                    height: self.texture_size[1] + dp(6)

                                MDList:
                                    id: dash_boss_list

            MDBottomNavigationItem:
                name: "tab_char"
                text: "Char"
                icon: "account-search"

                MDScrollView:
                    do_scroll_x: False

                    MDBoxLayout:
                        orientation: "vertical"
                        padding: dp(12)
                        spacing: dp(10)
                        size_hint_y: None
                        height: self.minimum_height
                        adaptive_height: True

                        MDBoxLayout:
                            id: world_row
                            size_hint_y: None
                            height: dp(56)
                            spacing: dp(8)

                            MDTextField:
                                id: char_name
                                hint_text: "Nome do personagem"
                                mode: "rectangle"
                                multiline: False
                                on_text_validate: app.search_character()

                            MDIconButton:
                                icon: "history"
                                on_release: app.open_char_history_menu()

                            MDIconButton:
                                icon: "close"
                                on_release: app.clear_char_search()

                        ActionRow:
                            MDRaisedButton:
                                text: "Buscar"
                                on_release: app.search_character()

                            MDRectangleFlatIconButton:
                                icon: "open-in-new"
                                text: "Tibia.com"
                                on_release: app.open_last_in_browser()

                            MDRectangleFlatIconButton:
                                icon: "star-plus-outline"
                                text: "Favoritar"
                                on_release: app.add_current_to_favorites()

                        MDCard:
                            id: char_result_card
                            orientation: "vertical"
                            padding: dp(12)
                            spacing: dp(6)
                            size_hint_y: None
                            height: self.minimum_height
                            radius: [dp(16), dp(16), dp(16), dp(16)]
                            elevation: 1

                            MDBoxLayout:
                                orientation: "horizontal"
                                size_hint_y: None
                                height: self.minimum_height
                                spacing: dp(8)

                                MDLabel:
                                    id: char_title
                                    text: "Faça uma busca"
                                    font_style: "H6"
                                    bold: True
                                    size_hint_y: None
                                    height: self.texture_size[1] + dp(4)

                                MDLabel:
                                    id: char_badge
                                    text: ""
                                    markup: True
                                    halign: "right"
                                    size_hint_y: None
                                    height: self.texture_size[1] + dp(4)

                            MDSeparator:
                                height: dp(1)

                            MDList:
                                id: char_details_list
                                size_hint_y: None
                                height: self.minimum_height

                                OneLineIconListItem:
                                    text: "Digite o nome e toque em Buscar."
                                    IconLeftWidget:
                                        icon: "information-outline"

                        MDCard:
                            id: char_xp_card
                            orientation: "vertical"
                            padding: dp(12)
                            spacing: dp(6)
                            size_hint_y: None
                            height: self.minimum_height
                            radius: [dp(16), dp(16), dp(16), dp(16)]
                            elevation: 1

                            MDBoxLayout:
                                size_hint_y: None
                                height: dp(32)
                                spacing: dp(6)

                                MDLabel:
                                    text: "XP últimos 30 dias"
                                    font_style: "Subtitle1"
                                    bold: True

                                Widget:
                                    size_hint_x: 1

                                MDIconButton:
                                    icon: "open-in-new"
                                    on_release: app.open_char_xp_source()

                            MDSeparator:
                                height: dp(1)

                            MDLabel:
                                id: char_xp_total
                                text: "—"
                                theme_text_color: "Hint"
                                size_hint_y: None
                                height: self.texture_size[1] + dp(6)

                            MDList:
                                id: char_xp_list
                                size_hint_y: None
                                height: self.minimum_height

                                OneLineIconListItem:
                                    text: "Faça uma busca para ver o histórico."
                                    IconLeftWidget:
                                        icon: "chart-line"

                        MDCard:
                            id: char_deaths_card
                            orientation: "vertical"
                            padding: dp(12)
                            spacing: dp(6)
                            size_hint_y: None
                            height: self.minimum_height
                            radius: [dp(16), dp(16), dp(16), dp(16)]
                            elevation: 1

                            MDBoxLayout:
                                size_hint_y: None
                                height: dp(32)
                                spacing: dp(6)

                                MDLabel:
                                    text: "Últimas mortes"
                                    font_style: "Subtitle1"
                                    bold: True

                                Widget:
                                    size_hint_x: 1

                                MDIconButton:
                                    icon: "content-copy"
                                    on_release: app.copy_deaths_to_clipboard()

                            MDSeparator:
                                height: dp(1)

                            MDList:
                                id: char_deaths_list
                                size_hint_y: None
                                height: self.minimum_height

                                OneLineIconListItem:
                                    text: "Nenhuma informação ainda."
                                    IconLeftWidget:
                                        icon: "skull-outline"

            MDBottomNavigationItem:
                name: "tab_share"
                text: "Share XP"
                icon: "account-group"

                MDScrollView:
                    do_scroll_x: False

                    MDBoxLayout:
                        orientation: "vertical"
                        padding: dp(12)
                        spacing: dp(12)
                        size_hint_y: None
                        height: self.minimum_height
                        adaptive_height: True

                        AppCard:
                            size_hint_y: None
                            height: self.minimum_height

                            MDBoxLayout:
                                orientation: "vertical"
                                spacing: dp(10)
                                size_hint_y: None
                                height: self.minimum_height

                                SectionTitle:
                                    text: "Calculadora de Shared XP"

                                HintText:
                                    text: "Informe seu level e veja a faixa permitida para shared."

                                MDTextField:
                                    id: share_level
                                    hint_text: "Seu level"
                                    mode: "rectangle"
                                    input_filter: "int"

                                ActionRow:
                                    MDRaisedButton:
                                        text: "Calcular"
                                        on_release: app.calc_shared_xp()

                                MDLabel:
                                    id: share_result
                                    text: ""
                                    halign: "left"
                                    valign: "top"
                                    text_size: self.width, None
                                    size_hint_y: None
                                    height: self.texture_size[1] + dp(20)


            MDBottomNavigationItem:
                name: "tab_fav"
                text: "Favoritos"
                icon: "star"

                MDScrollView:
                    do_scroll_x: False

                    MDBoxLayout:
                        orientation: "vertical"
                        padding: dp(12)
                        spacing: dp(12)
                        size_hint_y: None
                        height: self.minimum_height
                        adaptive_height: True

                        AppCard:
                            size_hint_y: None
                            height: self.minimum_height

                            MDBoxLayout:
                                orientation: "vertical"
                                spacing: dp(10)
                                size_hint_y: None
                                height: self.minimum_height

                                MDBoxLayout:
                                    size_hint_y: None
                                    height: dp(36)

                                    SectionTitle:
                                        text: "Favoritos"

                                    MDIconButton:
                                        icon: "refresh"
                                        on_release: app.refresh_favorites_list(force=True)

                                HintText:
                                    text: "Toque em um favorito para opções."

                                MDSeparator:
                                    height: dp(1)

                                MDList:
                                    id: fav_list
                                    size_hint_y: None
                                    height: self.minimum_height
            MDBottomNavigationItem:
                name: "tab_more"
                text: "Mais"
                icon: "dots-horizontal"

                MDScrollView:
                    do_scroll_x: False

                    MDBoxLayout:
                        orientation: "vertical"
                        padding: dp(12)
                        spacing: dp(12)
                        size_hint_y: None
                        height: self.minimum_height
                        adaptive_height: True

                        AppCard:
                            size_hint_y: None
                            height: self.minimum_height

                            MDBoxLayout:
                                orientation: "vertical"
                                spacing: dp(6)
                                size_hint_y: None
                                height: self.minimum_height

                                SectionTitle:
                                    text: "Ferramentas"

                                MDSeparator:
                                    height: dp(1)

                                MDList:
                                    MoreItem:
                                        text: "Bosses (ExevoPan)"
                                        icon: "skull"
                                        on_release: app.open_more_target("bosses")
                                    MoreItem:
                                        text: "Boosted"
                                        icon: "star-four-points"
                                        on_release: app.open_more_target("boosted")
                                    MoreItem:
                                        text: "Treino (Exercise)"
                                        icon: "dumbbell"
                                        on_release: app.open_more_target("training")
                                    MoreItem:
                                        text: "Imbuements"
                                        icon: "flash"
                                        on_release: app.open_more_target("imbuements")
                                    MoreItem:
                                        text: "Stamina"
                                        icon: "timer-outline"
                                        on_release: app.open_more_target("stamina")
                                    MoreItem:
                                        text: "Hunt Analyzer"
                                        icon: "chart-bar"
                                        on_release: app.open_more_target("hunt")
                                    MoreItem:
                                        text: "Novidades"
                                        icon: "new-box"
                                        on_release: app.open_more_target("changelog")
                                    MoreItem:
                                        text: "Sobre"
                                        icon: "information-outline"
                                        on_release: app.open_more_target("about")
                                    MoreItem:
                                        text: "Feedback"
                                        icon: "message-text"
                                        on_release: app.open_more_target("feedback")
                                    MoreItem:
                                        text: "Configurações"
                                        icon: "cog"
                                        on_release: app.open_more_target("settings")

<BossesScreen@MDScreen>:
    MDBoxLayout:
        orientation: "vertical"

        MDTopAppBar:
            title: "Bosses (ExevoPan)"
            left_action_items: [["arrow-left", lambda x: app.back_home()]]
            elevation: 2

        MDScrollView:
            do_scroll_x: False

            MDBoxLayout:
                orientation: "vertical"
                padding: dp(12)
                spacing: dp(12)
                size_hint_y: None
                height: self.minimum_height

                AppCard:
                    size_hint_y: None
                    height: self.minimum_height

                    MDBoxLayout:
                        orientation: "vertical"
                        spacing: dp(10)
                        size_hint_y: None
                        height: self.minimum_height

                        SectionTitle:
                            text: "World"

                        MDBoxLayout:
                            size_hint_y: None
                            height: dp(56)
                            spacing: dp(8)

                            MDTextField:
                                id: world_field
                                hint_text: "World"
                                mode: "rectangle"

                            MDIconButton:
                                id: world_drop
                                icon: "menu-down"
                                on_release:
                                    app.open_world_menu()

                        ActionRow:
                            MDRaisedButton:
                                text: "Buscar"
                                on_release: app.bosses_fetch()

                            MDRectangleFlatIconButton:
                                icon: "star-box-multiple-outline"
                                text: "Favoritos"
                                on_release: app.open_boss_favorites()

                        HintText:
                            id: boss_status
                            text: ""

                AppCard:
                    size_hint_y: None
                    height: self.minimum_height

                    MDBoxLayout:
                        orientation: "vertical"
                        spacing: dp(10)
                        size_hint_y: None
                        height: self.minimum_height

                        SectionTitle:
                            text: "Filtros"

                        MDBoxLayout:
                            size_hint_y: None
                            height: dp(56)
                            spacing: dp(8)

                            MDTextField:
                                id: boss_search
                                hint_text: "Buscar boss..."
                                mode: "rectangle"
                                on_text: app.bosses_apply_filters_debounced()

                            MDIconButton:
                                id: boss_filter_btn
                                icon: "filter-variant"
                                on_release: app.open_boss_filter_menu()

                            MDIconButton:
                                id: boss_sort_btn
                                icon: "sort"
                                on_release: app.open_boss_sort_menu()

                            MDIconButton:
                                id: boss_fav_toggle
                                icon: "star-outline"
                                on_release: app.bosses_toggle_fav_only()

                        MDBoxLayout:
                            size_hint_y: None
                            height: dp(22)
                            spacing: dp(12)

                            MDLabel:
                                id: boss_filter_label
                                text: "All"
                                theme_text_color: "Hint"
                                size_hint_x: .5

                            MDLabel:
                                id: boss_sort_label
                                text: "Chance"
                                theme_text_color: "Hint"
                                halign: "right"

                AppCard:
                    size_hint_y: None
                    height: self.minimum_height

                    MDBoxLayout:
                        orientation: "vertical"
                        spacing: dp(8)
                        size_hint_y: None
                        height: self.minimum_height

                        SectionTitle:
                            text: "Lista"

                        MDSeparator:
                            height: dp(1)

                        MDList:
                            id: boss_list
                            size_hint_y: None
                            height: self.minimum_height

<BoostedScreen@MDScreen>:
    MDBoxLayout:
        orientation: "vertical"

        MDTopAppBar:
            title: "Boosted"
            left_action_items: [["arrow-left", lambda x: app.back_home()]]
            right_action_items: [["refresh", lambda x: app.update_boosted()]]
            elevation: 2

        MDScrollView:
            do_scroll_x: False

            MDBoxLayout:
                orientation: "vertical"
                padding: dp(12)
                spacing: dp(12)
                size_hint_y: None
                height: self.minimum_height

                HintText:
                    id: boost_status
                    text: ""

                MDBoxLayout:
                    orientation: "horizontal"
                    spacing: dp(12)
                    size_hint_y: None
                    height: dp(138)

                    AppCard:
                        size_hint_x: 0.5
                        size_hint_y: None
                        height: dp(138)

                        MDBoxLayout:
                            orientation: "vertical"
                            spacing: dp(10)
                            size_hint_y: None
                            height: self.minimum_height

                            SectionTitle:
                                text: "Criatura Boosted"

                            MDBoxLayout:
                                orientation: "horizontal"
                                spacing: dp(10)
                                size_hint_y: None
                                height: dp(64)

                                AnchorLayout:
                                    size_hint: None, None
                                    size: dp(64), dp(64)
                                    anchor_x: "center"
                                    anchor_y: "center"

                                    AsyncImage:
                                        id: boost_creature_sprite
                                        source: ""
                                        size_hint: None, None
                                        size: dp(56), dp(56)
                                        allow_stretch: True
                                        keep_ratio: True
                                        opacity: 1 if self.source else 0

                                MDLabel:
                                    id: boost_creature
                                    text: "-"
                                    valign: "middle"
                                    halign: "left"
                                    text_size: self.size

                    AppCard:
                        size_hint_x: 0.5
                        size_hint_y: None
                        height: dp(138)

                        MDBoxLayout:
                            orientation: "vertical"
                            spacing: dp(10)
                            size_hint_y: None
                            height: self.minimum_height

                            SectionTitle:
                                text: "Boss Boosted"

                            MDBoxLayout:
                                orientation: "horizontal"
                                spacing: dp(10)
                                size_hint_y: None
                                height: dp(64)

                                AnchorLayout:
                                    size_hint: None, None
                                    size: dp(64), dp(64)
                                    anchor_x: "center"
                                    anchor_y: "center"

                                    AsyncImage:
                                        id: boost_boss_sprite
                                        source: ""
                                        size_hint: None, None
                                        size: dp(56), dp(56)
                                        allow_stretch: True
                                        keep_ratio: True
                                        opacity: 1 if self.source else 0

                                MDLabel:
                                    id: boost_boss
                                    text: "-"
                                    valign: "middle"
                                    halign: "left"
                                    text_size: self.size

                AppCard:
                    size_hint_y: None
                    height: self.minimum_height

                    MDBoxLayout:
                        orientation: "vertical"
                        spacing: dp(8)
                        size_hint_y: None
                        height: self.minimum_height

                        SectionTitle:
                            text: "Histórico (7 dias)"

                        MDSeparator:
                            height: dp(1)

                        MDList:
                            id: boost_hist_list
                            size_hint_y: None
                            height: self.minimum_height

<TrainingScreen@MDScreen>:
    MDBoxLayout:
        orientation: "vertical"

        MDTopAppBar:
            title: "Treino (Exercise)"
            left_action_items: [["arrow-left", lambda x: app.back_home()]]
            elevation: 2

        MDScrollView:
            do_scroll_x: False

            MDBoxLayout:
                orientation: "vertical"
                padding: dp(12)
                spacing: dp(12)
                size_hint_y: None
                height: self.minimum_height

                AppCard:
                    size_hint_y: None
                    height: self.minimum_height

                    MDBoxLayout:
                        orientation: "vertical"
                        spacing: dp(10)
                        size_hint_y: None
                        height: self.minimum_height

                        SectionTitle:
                            text: "Configuração"

                        MDBoxLayout:
                            size_hint_y: None
                            height: dp(56)
                            spacing: dp(8)

                            MDTextField:
                                id: skill_field
                                hint_text: "Skill"
                                text: "Sword"
                                mode: "rectangle"
                                readonly: True

                            MDIconButton:
                                id: skill_drop
                                icon: "menu-down"
                                on_release:
                                    app._ensure_training_menus()
                                    if app._menu_skill: app._menu_skill.open()

                        MDBoxLayout:
                            size_hint_y: None
                            height: dp(56)
                            spacing: dp(8)

                            MDTextField:
                                id: voc_field
                                hint_text: "Vocação"
                                text: "Knight"
                                mode: "rectangle"
                                readonly: True

                            MDIconButton:
                                id: voc_drop
                                icon: "menu-down"
                                on_release:
                                    app._ensure_training_menus()
                                    if app._menu_vocation: app._menu_vocation.open()

                        MDBoxLayout:
                            size_hint_y: None
                            height: dp(56)
                            spacing: dp(8)

                            MDTextField:
                                id: weapon_field
                                hint_text: "Arma de treino"
                                text: "Enhanced (1800)"
                                mode: "rectangle"
                                readonly: True

                            MDIconButton:
                                id: weapon_drop
                                icon: "menu-down"
                                on_release:
                                    app._ensure_training_menus()
                                    if app._menu_weapon: app._menu_weapon.open()

                AppCard:
                    size_hint_y: None
                    height: self.minimum_height

                    MDBoxLayout:
                        orientation: "vertical"
                        spacing: dp(10)
                        size_hint_y: None
                        height: self.minimum_height

                        SectionTitle:
                            text: "Níveis"

                        MDBoxLayout:
                            size_hint_y: None
                            height: dp(56)
                            spacing: dp(8)

                            MDTextField:
                                id: from_level
                                hint_text: "De"
                                mode: "rectangle"
                                input_filter: "int"

                            MDTextField:
                                id: percent_left
                                hint_text: "% restante (1-100)"
                                mode: "rectangle"
                                input_filter: "float"
                                text: "100"

                            MDTextField:
                                id: to_level
                                hint_text: "Até"
                                mode: "rectangle"
                                input_filter: "int"

                        MDTextField:
                            id: loyalty
                            hint_text: "Loyalty (%) (0-50)"
                            mode: "rectangle"
                            input_filter: "float"
                            text: "0"

                AppCard:
                    size_hint_y: None
                    height: self.minimum_height

                    MDBoxLayout:
                        orientation: "vertical"
                        spacing: dp(10)
                        size_hint_y: None
                        height: self.minimum_height

                        SectionTitle:
                            text: "Bônus"

                        MDBoxLayout:
                            size_hint_y: None
                            height: dp(48)
                            spacing: dp(10)

                            MDLabel:
                                text: "Private dummy (+10%)"
                                valign: "middle"

                            MDSwitch:
                                id: private_dummy
                                active: False

                        MDBoxLayout:
                            size_hint_y: None
                            height: dp(48)
                            spacing: dp(10)

                            MDLabel:
                                text: "Double event (x2)"
                                valign: "middle"

                            MDSwitch:
                                id: double_event
                                active: False

                ActionRow:
                    MDRaisedButton:
                        text: "Calcular"
                        on_release: app.training_calculate()

                HintText:
                    id: train_status
                    text: ""

                AppCard:
                    size_hint_y: None
                    height: self.minimum_height

                    MDBoxLayout:
                        orientation: "vertical"
                        spacing: dp(8)
                        size_hint_y: None
                        height: self.minimum_height

                        SectionTitle:
                            text: "Resultado"

                        MDLabel:
                            id: train_result
                            text: ""
                            halign: "left"
                            valign: "top"
                            size_hint_y: None
                            height: self.texture_size[1] + dp(20)

<ImbuementsScreen@MDScreen>:
    MDBoxLayout:
        orientation: "vertical"

        MDTopAppBar:
            title: "Imbuements (TibiaWiki)"
            left_action_items: [["arrow-left", lambda x: app.back_home()]]
            right_action_items: [["refresh", lambda x: app._imbuements_load()]]
            elevation: 2

        MDScrollView:
            do_scroll_x: False

            MDBoxLayout:
                orientation: "vertical"
                padding: dp(12)
                spacing: dp(12)
                size_hint_y: None
                height: self.minimum_height

                AppCard:
                    size_hint_y: None
                    height: self.minimum_height

                    MDBoxLayout:
                        orientation: "vertical"
                        spacing: dp(10)
                        size_hint_y: None
                        height: self.minimum_height

                        SectionTitle:
                            text: "Filtros"

                        MDBoxLayout:
                            size_hint_y: None
                            height: dp(44)
                            spacing: dp(8)

                            MDIconButton:
                                id: imb_tier_btn
                                icon: "tag-outline"
                                on_release: app.open_imb_tier_menu()

                            MDLabel:
                                id: imb_tier_label
                                text: "All"
                                theme_text_color: "Hint"
                                size_hint_x: None
                                width: dp(60)

                            MDIconButton:
                                id: imb_fav_toggle
                                icon: "star-outline"
                                on_release: app.imbuements_toggle_fav_only()

                            MDIconButton:
                                icon: "content-copy"
                                on_release: app.imbuements_copy_selected_hint()

                        MDTextField:
                            id: imb_search
                            hint_text: "Buscar (ex: Vampirism, Strike...)"
                            mode: "rectangle"
                            on_text: app.imbuements_refresh_list()

                        HintText:
                            id: imb_status
                            text: "Toque em refresh para carregar."

                AppCard:
                    size_hint_y: None
                    height: self.minimum_height

                    MDBoxLayout:
                        orientation: "vertical"
                        spacing: dp(8)
                        size_hint_y: None
                        height: self.minimum_height

                        SectionTitle:
                            text: "Lista"

                        MDSeparator:
                            height: dp(1)

                        MDList:
                            id: imb_list
                            size_hint_y: None
                            height: self.minimum_height

<HuntScreen@MDScreen>:
    MDBoxLayout:
        orientation: "vertical"

        MDTopAppBar:
            title: "Hunt Analyzer"
            left_action_items: [["arrow-left", lambda x: app.back_home()]]
            elevation: 2

        MDScrollView:
            do_scroll_x: False

            MDBoxLayout:
                orientation: "vertical"
                padding: dp(12)
                spacing: dp(12)
                size_hint_y: None
                height: self.minimum_height

                AppCard:
                    size_hint_y: None
                    height: self.minimum_height

                    MDBoxLayout:
                        orientation: "vertical"
                        spacing: dp(10)
                        size_hint_y: None
                        height: self.minimum_height

                        SectionTitle:
                            text: "Entrada"

                        HintText:
                            text: "Cole aqui o texto do Session Data do Tibia."

                        MDTextField:
                            id: hunt_input
                            hint_text: "Session Data"
                            mode: "rectangle"
                            multiline: True
                            size_hint_y: None
                            height: dp(220)

                        ActionRow:
                            MDRaisedButton:
                                text: "Analisar"
                                on_release: app.hunt_parse()

                ActionRow:
                    MDRaisedButton:
                        id: hunt_copy_btn
                        text: "Copiar"
                        on_release: app.hunt_copy()

                    MDRectangleFlatIconButton:
                        icon: "share-variant"
                        text: "Compartilhar"
                        on_release: app.hunt_share()

                HintText:
                    id: hunt_status
                    text: ""

                AppCard:
                    size_hint_y: None
                    height: self.minimum_height

                    MDBoxLayout:
                        orientation: "vertical"
                        spacing: dp(10)
                        size_hint_y: None
                        height: self.minimum_height

                        SectionTitle:
                            text: "Resultado"

                        MDTextField:
                            id: hunt_output
                            hint_text: "Resultado"
                            mode: "rectangle"
                            multiline: True
                            readonly: True
                            size_hint_y: None
                            height: dp(260)

<StaminaScreen@MDScreen>:
    MDBoxLayout:
        orientation: "vertical"

        MDTopAppBar:
            title: "Stamina"
            left_action_items: [["arrow-left", lambda x: app.back_home()]]
            elevation: 2

        MDScrollView:
            do_scroll_x: False

            MDBoxLayout:
                orientation: "vertical"
                padding: dp(12)
                spacing: dp(12)
                size_hint_y: None
                height: self.minimum_height

                AppCard:
                    size_hint_y: None
                    height: self.minimum_height

                    MDBoxLayout:
                        orientation: "vertical"
                        spacing: dp(10)
                        size_hint_y: None
                        height: self.minimum_height

                        SectionTitle:
                            text: "Calculadora de Stamina (offline)"

                        HintText:
                            text: "A regeneração começa 10 min após deslogar. Até 39:00 é mais rápida; de 39:00 a 42:00 (verde) é mais lenta."

                        MDLabel:
                            text: "Stamina atual"
                            size_hint_y: None
                            height: dp(20)

                        MDBoxLayout:
                            size_hint_y: None
                            height: dp(56)
                            spacing: dp(8)

                            MDTextField:
                                id: stam_cur_h
                                hint_text: "Horas"
                                mode: "rectangle"
                                input_filter: "int"

                            MDTextField:
                                id: stam_cur_m
                                hint_text: "Min"
                                mode: "rectangle"
                                input_filter: "int"

                        MDLabel:
                            text: "Stamina desejada"
                            size_hint_y: None
                            height: dp(20)

                        MDBoxLayout:
                            size_hint_y: None
                            height: dp(56)
                            spacing: dp(8)

                            MDTextField:
                                id: stam_tgt_h
                                hint_text: "Horas"
                                mode: "rectangle"
                                input_filter: "int"

                            MDTextField:
                                id: stam_tgt_m
                                hint_text: "Min"
                                mode: "rectangle"
                                input_filter: "int"

                        ActionRow:
                            MDRaisedButton:
                                text: "Calcular"
                                on_release: app.stamina_calculate()

                        MDLabel:
                            id: stam_result
                            text: ""
                            halign: "left"
                            valign: "top"
                            text_size: self.width, None
                            size_hint_y: None
                            height: self.texture_size[1] + dp(20)

<SettingsScreen@MDScreen>:
    MDBoxLayout:
        orientation: "vertical"

        MDTopAppBar:
            title: "Configurações"
            left_action_items: [["arrow-left", lambda x: app.back_home()]]
            elevation: 2

        MDScrollView:
            do_scroll_x: False

            MDBoxLayout:
                orientation: "vertical"
                padding: dp(12)
                spacing: dp(12)
                size_hint_y: None
                height: self.minimum_height

                AppCard:
                    size_hint_y: None
                    height: self.minimum_height

                    MDBoxLayout:
                        orientation: "vertical"
                        spacing: dp(10)
                        size_hint_y: None
                        height: self.minimum_height

                        SectionTitle:
                            text: "Aparência"

                        MDBoxLayout:
                            size_hint_y: None
                            height: dp(48)
                            spacing: dp(10)

                            MDLabel:
                                text: "Tema claro"
                                valign: "middle"

                            MDSwitch:
                                id: set_theme_light
                                active: False

                AppCard:
                    size_hint_y: None
                    height: self.minimum_height

                    MDBoxLayout:
                        orientation: "vertical"
                        spacing: dp(10)
                        size_hint_y: None
                        height: self.minimum_height

                        SectionTitle:
                            text: "Notificações (ao abrir o app)"

                        MDBoxLayout:
                            size_hint_y: None
                            height: dp(48)
                            spacing: dp(10)

                            MDLabel:
                                text: "Boosted mudou"
                                valign: "middle"

                            MDSwitch:
                                id: set_notify_boosted
                                active: False

                        MDBoxLayout:
                            size_hint_y: None
                            height: dp(48)
                            spacing: dp(10)

                            MDLabel:
                                text: "Boss favorito High"
                                valign: "middle"

                            MDSwitch:
                                id: set_notify_boss_high
                                active: False

                AppCard:
                    size_hint_y: None
                    height: self.minimum_height

                    MDBoxLayout:
                        orientation: "vertical"
                        spacing: dp(10)
                        size_hint_y: None
                        height: self.minimum_height

                        SectionTitle:
                            text: "Favoritos (segundo plano)"

                        HintText:
                            text: "Notificações mesmo com o app fechado. Isso roda como serviço em primeiro plano (pode aparecer um aviso fixo do Android)."

                        MDBoxLayout:
                            size_hint_y: None
                            height: dp(48)
                            spacing: dp(10)

                            MDLabel:
                                text: "Monitorar favoritos"
                                valign: "middle"

                            MDSwitch:
                                id: set_bg_monitor
                                active: True

                        MDBoxLayout:
                            size_hint_y: None
                            height: dp(48)
                            spacing: dp(10)

                            MDLabel:
                                text: "Avisar quando ficar online"
                                valign: "middle"

                            MDSwitch:
                                id: set_bg_notify_online
                                active: True

                        MDBoxLayout:
                            size_hint_y: None
                            height: dp(48)
                            spacing: dp(10)

                            MDLabel:
                                text: "Avisar quando upar level"
                                valign: "middle"

                            MDSwitch:
                                id: set_bg_notify_level
                                active: True

                        MDBoxLayout:
                            size_hint_y: None
                            height: dp(48)
                            spacing: dp(10)

                            MDLabel:
                                text: "Avisar quando morrer"
                                valign: "middle"

                            MDSwitch:
                                id: set_bg_notify_death
                                active: True

                        MDTextField:
                            id: set_bg_interval
                            hint_text: "Intervalo do monitor (segundos) - ex: 60"
                            text: "60"
                            mode: "rectangle"
                            input_filter: "int"

                AppCard:
                    size_hint_y: None
                    height: self.minimum_height

                    MDBoxLayout:
                        orientation: "vertical"
                        spacing: dp(10)
                        size_hint_y: None
                        height: self.minimum_height

                        SectionTitle:
                            text: "Updates (GitHub)"

                        MDTextField:
                            id: set_repo_url
                            hint_text: "URL do repo (ex: https://github.com/user/repo)"
                            mode: "rectangle"

                        ActionRow:
                            MDRaisedButton:
                                text: "Salvar"
                                on_release: app.settings_save()

                            MDRectangleFlatIconButton:
                                icon: "cloud-download-outline"
                                text: "Checar"
                                on_release: app.settings_check_updates()

                        ActionRow:
                            MDRectangleFlatIconButton:
                                icon: "github"
                                text: "Releases"
                                on_release: app.settings_open_releases()

                            MDRectangleFlatIconButton:
                                icon: "broom"
                                text: "Limpar cache"
                                on_release: app.settings_clear_cache()

                        HintText:
                            id: set_status
                            text: ""


<BossFavoritesScreen@MDScreen>:
    MDBoxLayout:
        orientation: "vertical"

        MDTopAppBar:
            title: "Bosses Favoritos"
            left_action_items: [["arrow-left", lambda x: app.go('bosses')]]
            right_action_items: [["refresh", lambda x: app.boss_favorites_refresh()]]
            elevation: 2

        MDScrollView:
            do_scroll_x: False

            MDBoxLayout:
                orientation: "vertical"
                padding: dp(12)
                spacing: dp(12)
                size_hint_y: None
                height: self.minimum_height

                HintText:
                    id: boss_fav_status
                    text: "Favoritos: -"

                AppCard:
                    size_hint_y: None
                    height: self.minimum_height

                    MDBoxLayout:
                        orientation: "vertical"
                        spacing: dp(8)
                        size_hint_y: None
                        height: self.minimum_height

                        SectionTitle:
                            text: "Lista"

                        MDSeparator:
                            height: dp(1)

                        MDList:
                            id: boss_fav_list
                            size_hint_y: None
                            height: self.minimum_height
